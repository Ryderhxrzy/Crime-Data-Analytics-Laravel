const r=class r{static showIncidentNotification(o,t,i){console.log(`ğŸ”” NotificationManager.showIncidentNotification called (ID: ${t.id}, Event: ${i})`),"Notification"in window&&Notification.permission==="default"?Notification.requestPermission().then(c=>{c==="granted"&&this.createDesktopNotification(o,t,i)}):"Notification"in window&&Notification.permission==="granted"&&this.createDesktopNotification(o,t,i)}static createDesktopNotification(o,t,i){try{const c=this.getNotificationIcon(i),e=this.getDynamicLink(t.id),n=this.buildNotificationBody(t,i),s=new Notification(o,{body:n,icon:"/images/alertara.png",badge:"/images/alertara.png",tag:`crime-incident-${t.id}-${i}`,requireInteraction:!0,silent:!1});setTimeout(()=>{s.close(),this.activeNotifications.delete(`crime-incident-${t.id}-${i}`)},8e3),s.onclick=()=>{t.id?window.open(e,"_blank"):window.focus(),s.close(),this.activeNotifications.delete(`crime-incident-${t.id}-${i}`)},this.activeNotifications.set(`crime-incident-${t.id}-${i}`,s)}catch(c){console.error("Error creating desktop notification:",c)}}static buildNotificationBody(o,t){const i=[];if(i.push(`ğŸ“Œ ${o.incident_title}`),(o.category_name||o.location)&&i.push(`ğŸ“ ${o.category_name||"Unknown"} â€¢ ${o.location||"Unknown Location"}`),o.status||o.clearance_status){const e=o.status==="under_investigation"?"Under Investigation":o.status||"Unknown",n=o.clearance_status==="uncleared"?"Uncleared":o.clearance_status||"Unknown";i.push(`ğŸ·ï¸ Status: ${e} â€¢ Clearance: ${n}`)}if(o.incident_date){const e=new Date(o.incident_date).toLocaleDateString();i.push(`ğŸ“… ${e}`)}const c=t==="created"?"ğŸ†• New Report":t==="updated"?"ğŸ”„ Updated":t==="deleted"?"ğŸ—‘ï¸ Removed":"â„¹ï¸ Notice";return i.push(c),i.join(`
`)}static getDynamicLink(o){const i=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes(".local")?`${window.location.protocol}//${window.location.host}`:"https://crime-analytics.alertaraqc.com";return o?`${i}/crimes#${o}`:`${i}/crimes`}static getNotificationIcon(o){switch(o){case"created":return"âœ…";case"updated":return"ğŸ”„";case"deleted":return"ğŸ—‘ï¸";default:return"â„¹ï¸"}}};r.activeNotifications=new Map;let a=r;typeof window<"u"&&(window.NotificationManager=a);
