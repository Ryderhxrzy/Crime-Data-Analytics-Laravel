class u{constructor(){this.otpInputs=[],this.otpTimerInterval=null,this.resendTimerInterval=null,this.otpCode="",this.selectedIncidentId=null,this.otpExpiryTime=0,this.resendCooldownTime=0,this.jwtToken="",this.isDecryptionSessionValid=!1,this.autoDecryptInProgress=!1,this.decryptedIncidents=new Set,this.initializeElements(),this.setupEventListeners(),this.getJwtToken(),this.checkDecryptionSessionValidity()}initializeElements(){this.modal=document.getElementById("decryptionModal"),this.decryptBtn=document.getElementById("decryptDataBtn"),this.closeBtn=document.getElementById("closeDecryptionModal"),this.sendOtpBtn=document.getElementById("sendOtpBtn"),this.verifyOtpBtn=document.getElementById("verifyOtpBtn"),this.resendOtpBtn=document.getElementById("resendOtpBtn"),this.backBtn=document.getElementById("backToStep1"),this.step1Container=document.getElementById("decryptionStep1"),this.step2Container=document.getElementById("decryptionStep2"),this.otpInputs=Array.from(document.querySelectorAll("#decryptionModal .otp-input"))}async checkDecryptionSessionValidity(){try{const t=await(await fetch("/decrypt-data/status",{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.jwtToken?`Bearer ${this.jwtToken}`:""},credentials:"include"})).json();this.isDecryptionSessionValid=t.decryption_allowed===!0,console.log("Decryption session valid:",this.isDecryptionSessionValid),this.isDecryptionSessionValid&&this.waitForTableAndDecrypt()}catch(e){console.warn("Could not check decryption session validity:",e),this.isDecryptionSessionValid=!1}}waitForTableAndDecrypt(){let e=0;const t=20,s=()=>{const n=document.getElementById("crimesTableBody");n&&n.querySelectorAll("[data-incident-id]").length>0?(console.log("[Decryption] Table loaded, starting auto-decryption..."),this.autoDecryptTableData()):e<t?(e++,setTimeout(s,100)):console.log("[Decryption] Table not found or empty after retries")};s()}async retryAutoDecryption(){await this.checkDecryptionSessionValidity()}async autoDecryptTableData(){if(this.autoDecryptInProgress){console.log("[Decryption] Auto-decryption already in progress, skipping...");return}this.autoDecryptInProgress=!0;try{const e=document.querySelectorAll("[data-incident-id]");for(const t of e){const s=t.getAttribute("data-incident-id");if(s&&!this.decryptedIncidents.has(parseInt(s))){this.decryptedIncidents.add(parseInt(s)),this.showLoadingInColumns(parseInt(s));try{const n=await this.getCachedDecryptedData(s);if(n){console.log(`[Decryption] Using cached data for incident ${s}`),this.updateTableWithDecryptedData(n,parseInt(s)),await new Promise(a=>setTimeout(a,100));continue}const o=await fetch("/decrypt-data/verify-otp",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken(),Authorization:this.jwtToken?`Bearer ${this.jwtToken}`:""},credentials:"include",body:JSON.stringify({otp:"session_valid",incident_id:s})}),i=await o.json();if(i.success)this.updateTableWithDecryptedData(i.data,parseInt(s)),console.log(`[Decryption] Successfully decrypted incident ${s}`);else if(o.status===410){this.isDecryptionSessionValid=!1,console.log("[Decryption] Session expired, will need new OTP");break}}catch(n){console.warn(`[Decryption] Failed to decrypt incident ${s}:`,n),this.removeLoadingFromColumns(parseInt(s))}await new Promise(n=>setTimeout(n,200))}}}catch(e){console.warn("[Decryption] Auto-decryption failed:",e)}finally{this.autoDecryptInProgress=!1}}showLoadingInColumns(e){const t=document.querySelectorAll(`[data-expand-target="${e}-persons"]`),s=document.querySelectorAll(`[data-expand-target="${e}-evidence"]`),n='<div class="flex items-center gap-2"><i class="fas fa-spinner fa-spin text-blue-500"></i><span class="text-xs text-gray-600">Decrypting...</span></div>';t.forEach(o=>{o.innerHTML=n}),s.forEach(o=>{o.innerHTML=n})}removeLoadingFromColumns(e){const t=document.querySelectorAll(`[data-expand-target="${e}-persons"]`),s=document.querySelectorAll(`[data-expand-target="${e}-evidence"]`);t.forEach(n=>{n.innerHTML.includes("fa-spinner")&&(n.innerHTML='<span class="text-gray-500 text-xs">None</span>')}),s.forEach(n=>{n.innerHTML.includes("fa-spinner")&&(n.innerHTML='<span class="text-gray-500 text-xs">None</span>')})}async getCachedDecryptedData(e){try{const t=await fetch(`/decrypt-data/get-cached/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.jwtToken?`Bearer ${this.jwtToken}`:""},credentials:"include"});if(t.ok){const s=await t.json();if(s.success&&s.data)return s.data}}catch{console.log(`[Decryption] No cached data for incident ${e}`)}return null}handleShowMore(e,t){console.log(`[Decryption] handleShowMore called: incidentId=${e}, dataType=${t}`);const s=`[data-expand-target="${e}-${t}"]`,n=document.querySelectorAll(s);console.log(`[Decryption] Found ${n.length} cells for selector: ${s}`),n.forEach((o,i)=>{console.log(`[Decryption] Processing cell ${i}:`,o);const a=o.closest("tr");if(console.log("[Decryption] Found row:",a),!a){console.warn("[Decryption] No row found for cell");return}const r=a.querySelector(`.show-more-button[data-target="${t}"]`);if(console.log("[Decryption] Found button:",r),!r){console.warn(`[Decryption] No button found in row for dataType=${t}`);return}const l=r.getAttribute("data-expanded")==="true",d=a.getAttribute(`data-${t}-cached`),p=parseInt(r.getAttribute("data-total")||"0");console.log(`[Decryption] State: isExpanded=${l}, totalItems=${p}`),console.log("[Decryption] Cached data attribute exists:",!!d),d&&console.log("[Decryption] Cached data (first 100 chars):",d.substring(0,100));let c=null;if(d)try{c=JSON.parse(d),console.log(`[Decryption] Successfully parsed ${(c==null?void 0:c.length)||0} items`)}catch(h){console.warn(`[Decryption] Failed to parse cached ${t} data:`,h,"Raw:",d);return}!l&&c?(console.log(`[Decryption] Showing all items (${c.length})`),r.setAttribute("data-expanded","true"),r.textContent="Show less",this.renderAllItems(o,c,t,e)):l&&c?(console.log("[Decryption] Showing first item only"),r.setAttribute("data-expanded","false"),r.textContent=`Show more (${p-1} more)`,c.length>0&&this.renderFirstItem(o,c[0],t,e)):console.warn(`[Decryption] No cached data found. items=${c}, isExpanded=${l}`)})}renderFirstItem(e,t,s,n){s==="persons"?e.innerHTML=`
                <span class="inline-block bg-green-200 text-green-900 px-2 py-0.5 rounded text-xs font-semibold mb-1">✓ ${(t.role||"Person").toUpperCase()}</span>
                <div class="ml-1 text-gray-900 font-medium text-xs">
                    <div><span class="text-gray-700">Name:</span> <strong>${t.first_name||""}${t.middle_name?" "+t.middle_name:""} ${t.last_name||""}</strong></div>
                    <div><span class="text-gray-700">Contact:</span> <strong>${t.contact_number||"N/A"}</strong></div>
                    <div><span class="text-gray-700">Other:</span> <strong>${t.other_info||"N/A"}</strong></div>
                </div>
            `:e.innerHTML=`
                <span class="inline-block bg-green-200 text-green-900 px-2 py-0.5 rounded text-xs font-semibold mb-1">✓ ${t.type||"Evidence"}</span>
                <div class="ml-1 text-gray-900 font-medium text-xs">
                    <div><span class="text-gray-700">Desc:</span> <strong>${t.description||"N/A"}</strong></div>
                    <div><span class="text-gray-700">Link:</span>
                        ${t.evidence_link?`<a href="${t.evidence_link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 font-semibold"><i class="fas fa-external-link-alt mr-1"></i>View</a>`:'<span class="text-gray-500">N/A</span>'}
                    </div>
                </div>
            `}renderAllItems(e,t,s,n){if(console.log(`[Decryption] renderAllItems called: dataType=${s}, itemCount=${t.length}, cell=`,e),s==="persons"){const o=t.map(i=>`
                <div class="mb-3 pb-3 border-b border-gray-100 last:border-b-0">
                    <span class="inline-block bg-green-200 text-green-900 px-2 py-0.5 rounded text-xs font-semibold mb-1">✓ ${(i.role||"Person").toUpperCase()}</span>
                    <div class="ml-1 text-gray-900 font-medium text-xs">
                        <div><span class="text-gray-700">Name:</span> <strong>${i.first_name||""}${i.middle_name?" "+i.middle_name:""} ${i.last_name||""}</strong></div>
                        <div><span class="text-gray-700">Contact:</span> <strong>${i.contact_number||"N/A"}</strong></div>
                        <div><span class="text-gray-700">Other:</span> <strong>${i.other_info||"N/A"}</strong></div>
                    </div>
                </div>
            `).join("");e.innerHTML=o,console.log(`[Decryption] Rendered ${t.length} persons items`)}else{const o=t.map(i=>`
                <div class="mb-3 pb-3 border-b border-gray-100 last:border-b-0">
                    <span class="inline-block bg-green-200 text-green-900 px-2 py-0.5 rounded text-xs font-semibold mb-1">✓ ${i.type||"Evidence"}</span>
                    <div class="ml-1 text-gray-900 font-medium text-xs">
                        <div><span class="text-gray-700">Desc:</span> <strong>${i.description||"N/A"}</strong></div>
                        <div><span class="text-gray-700">Link:</span>
                            ${i.evidence_link?`<a href="${i.evidence_link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 font-semibold"><i class="fas fa-external-link-alt mr-1"></i>View</a>`:'<span class="text-gray-500">N/A</span>'}
                        </div>
                    </div>
                </div>
            `).join("");e.innerHTML=o,console.log(`[Decryption] Rendered ${t.length} evidence items`)}}setupEventListeners(){var e,t,s,n,o,i,a;(e=this.decryptBtn)==null||e.addEventListener("click",()=>this.openModal()),(t=this.closeBtn)==null||t.addEventListener("click",()=>this.closeModal()),(s=this.sendOtpBtn)==null||s.addEventListener("click",()=>this.sendOtp()),(n=this.verifyOtpBtn)==null||n.addEventListener("click",()=>this.verifyOtp()),(o=this.resendOtpBtn)==null||o.addEventListener("click",()=>this.resendOtp()),(i=this.backBtn)==null||i.addEventListener("click",()=>this.goToStep1()),this.otpInputs.forEach((r,l)=>{r.addEventListener("input",d=>this.handleOtpInput(d,l)),r.addEventListener("keydown",d=>this.handleOtpKeydown(d,l)),r.addEventListener("paste",d=>this.handleOtpPaste(d))}),(a=this.modal)==null||a.addEventListener("click",r=>{r.target===this.modal&&this.closeModal()}),document.addEventListener("click",r=>{const d=r.target.closest(".show-more-button");if(d){const p=d.getAttribute("data-incident-id"),c=d.getAttribute("data-target");p&&c&&this.handleShowMore(parseInt(p),c)}}),document.addEventListener("crimePageTableRendered",()=>{console.log("[Decryption] Table re-rendered, triggering auto-decryption...");const r=document.querySelectorAll("[data-incident-id]"),l=new Set;r.forEach(p=>{const c=parseInt(p.getAttribute("data-incident-id")||"0");c&&l.add(c)});let d=!1;if(this.decryptedIncidents.size!==l.size)d=!0;else for(const p of this.decryptedIncidents)if(!l.has(p)){d=!0;break}d&&(console.log("[Decryption] Table data changed, resetting decryption tracking..."),this.decryptedIncidents.clear()),setTimeout(()=>{this.autoDecryptTableData()},100)})}getJwtToken(){this.jwtToken=sessionStorage.getItem("jwt_token")||""}openModal(){this.modal&&(this.modal.classList.remove("hidden"),this.goToStep1(),document.body.style.overflow="hidden")}closeModal(){this.modal&&(this.modal.classList.add("hidden"),document.body.style.overflow="",this.resetModal())}resetModal(){this.clearOtpInputs(),this.clearErrorMessages(),this.clearSuccessMessages(),this.stopOtpTimer(),this.stopResendTimer(),this.selectedIncidentId=null,this.otpCode="",this.sendOtpBtn&&(this.sendOtpBtn.disabled=!1),this.verifyOtpBtn&&(this.verifyOtpBtn.disabled=!0)}goToStep1(){var e,t;(e=this.step1Container)==null||e.classList.remove("hidden"),(t=this.step2Container)==null||t.classList.add("hidden"),this.clearErrorMessages(),this.clearOtpInputs()}goToStep2(){var e,t,s;(e=this.step1Container)==null||e.classList.add("hidden"),(t=this.step2Container)==null||t.classList.remove("hidden"),this.clearErrorMessages(),(s=this.otpInputs[0])==null||s.focus(),this.startOtpTimer()}async sendOtp(){try{if(this.sendOtpBtn){const o=this.sendOtpBtn;o.disabled=!0,o.classList.add("opacity-60","cursor-not-allowed")}this.setLoadingState("otpLoadingState",!0),this.clearErrorMessages();const e=document.querySelector("[data-incident-id]"),t=(e==null?void 0:e.getAttribute("data-incident-id"))||"0",s=await fetch("/decrypt-data/send-otp",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken(),Authorization:this.jwtToken?`Bearer ${this.jwtToken}`:""},credentials:"include",body:JSON.stringify({incident_id:t})}),n=await s.json();if(!s.ok||!n.success){if(this.showErrorMessage("otpErrorMessage","otpErrorText",n.message||"Failed to send OTP. Please try again."),s.status===429){const o=n.retry_after||60;this.showErrorMessage("otpErrorMessage","otpErrorText",`Too many requests. Please wait ${o} seconds.`)}if(this.sendOtpBtn){const o=this.sendOtpBtn;o.disabled=!1,o.classList.remove("opacity-60","cursor-not-allowed")}return}this.otpExpiryTime=n.expires_in||300,this.goToStep2(),this.showNotification("OTP sent to your email","success")}catch(e){if(console.error("Error sending OTP:",e),this.showErrorMessage("otpErrorMessage","otpErrorText","An error occurred. Please try again later."),this.sendOtpBtn){const t=this.sendOtpBtn;t.disabled=!1,t.classList.remove("opacity-60","cursor-not-allowed")}}finally{this.setLoadingState("otpLoadingState",!1)}}async verifyOtp(){var e;try{const t=this.getOtpCode();if(t.length!==6){this.showErrorMessage("verifyErrorMessage","verifyErrorText","Please enter all 6 digits of the OTP.");return}if(this.verifyOtpBtn){const a=this.verifyOtpBtn;a.disabled=!0,a.classList.add("opacity-60","cursor-not-allowed")}this.closeBtn&&(this.closeBtn.style.pointerEvents="none",this.closeBtn.style.opacity="0.5"),this.setLoadingState("verifyLoadingState",!0),this.clearErrorMessages();const s=document.querySelector("[data-incident-id]"),n=(s==null?void 0:s.getAttribute("data-incident-id"))||"1",o=await fetch("/decrypt-data/verify-otp",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken(),Authorization:this.jwtToken?`Bearer ${this.jwtToken}`:""},credentials:"include",body:JSON.stringify({otp:t,incident_id:n})}),i=await o.json();if(!o.ok||!i.success){if(this.showErrorMessage("verifyErrorMessage","verifyErrorText",i.message||"Failed to verify OTP. Please try again."),this.clearOtpInputs(),(e=this.otpInputs[0])==null||e.focus(),this.verifyOtpBtn){const a=this.verifyOtpBtn;a.disabled=!1,a.classList.remove("opacity-60","cursor-not-allowed")}this.closeBtn&&(this.closeBtn.style.pointerEvents="auto",this.closeBtn.style.opacity="1");return}this.showSuccessMessage("verifySuccessMessage","verifySuccessText","OTP verified! Decrypting data..."),this.isDecryptionSessionValid=!0,sessionStorage.setItem("decryption_session_valid","true"),setTimeout(()=>{var a;this.decryptedIncidents.add(parseInt(n)),this.updateTableWithDecryptedData(i.data,parseInt(n)),(a=window.NotificationManager)==null||a.showGenericNotification("Data Decryption Successful","Your sensitive data has been decrypted and is now visible in the table.","success"),this.closeModal()},1e3)}catch(t){if(console.error("Error verifying OTP:",t),this.showErrorMessage("verifyErrorMessage","verifyErrorText","An error occurred. Please try again."),this.verifyOtpBtn){const s=this.verifyOtpBtn;s.disabled=!1,s.classList.remove("opacity-60","cursor-not-allowed")}this.closeBtn&&(this.closeBtn.style.pointerEvents="auto",this.closeBtn.style.opacity="1")}finally{this.setLoadingState("verifyLoadingState",!1)}}async resendOtp(){try{this.resendOtpBtn&&(this.resendOtpBtn.disabled=!0),this.clearErrorMessages();const e=document.querySelector("[data-incident-id]"),t=(e==null?void 0:e.getAttribute("data-incident-id"))||"0",s=await fetch("/decrypt-data/send-otp",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken(),Authorization:this.jwtToken?`Bearer ${this.jwtToken}`:""},credentials:"include",body:JSON.stringify({incident_id:t})}),n=await s.json();if(!s.ok||!n.success){this.showErrorMessage("verifyErrorMessage","verifyErrorText",n.message||"Failed to resend OTP."),this.resendOtpBtn&&(this.resendOtpBtn.disabled=!1);return}this.clearOtpInputs(),this.otpExpiryTime=n.expires_in||300,this.startOtpTimer(),this.startResendCooldown(),this.showNotification("OTP resent to your email","success")}catch(e){console.error("Error resending OTP:",e),this.showErrorMessage("verifyErrorMessage","verifyErrorText","Failed to resend OTP. Please try again."),this.resendOtpBtn&&(this.resendOtpBtn.disabled=!1)}}handleOtpInput(e,t){const s=e.target,n=s.value;if(!/^\d?$/.test(n)){s.value="";return}n&&t<this.otpInputs.length-1&&this.otpInputs[t+1].focus(),this.updateVerifyButtonState()}handleOtpKeydown(e,t){const s=e.target;e.key==="Backspace"&&!s.value&&t>0&&this.otpInputs[t-1].focus(),e.key==="ArrowLeft"&&t>0&&(e.preventDefault(),this.otpInputs[t-1].focus()),e.key==="ArrowRight"&&t<this.otpInputs.length-1&&(e.preventDefault(),this.otpInputs[t+1].focus()),e.key==="Enter"&&(e.preventDefault(),this.verifyOtp())}handleOtpPaste(e){var n;e.preventDefault();const s=(((n=e.clipboardData)==null?void 0:n.getData("text"))||"").replace(/\D/g,"").split("").slice(0,6);this.otpInputs.forEach((o,i)=>{o.value=s[i]||""}),this.updateVerifyButtonState()}getOtpCode(){return this.otpInputs.map(e=>e.value).join("")}clearOtpInputs(){this.otpInputs.forEach(e=>{e.value=""}),this.updateVerifyButtonState()}updateVerifyButtonState(){const e=this.otpInputs.every(t=>t.value!=="");if(this.verifyOtpBtn){const t=this.verifyOtpBtn;t.disabled=!e,e?t.classList.remove("opacity-60","cursor-not-allowed"):t.classList.add("opacity-60","cursor-not-allowed")}}startOtpTimer(){this.stopOtpTimer();let e=this.otpExpiryTime;const t=document.getElementById("otpTimer"),s=()=>{const n=Math.floor(e/60),o=e%60,i=`${n}:${o.toString().padStart(2,"0")}`;t&&(t.textContent=`OTP expires in: ${i}`),e<=0&&(this.stopOtpTimer(),t&&(t.textContent="OTP Expired - Request a new one"),this.clearOtpInputs()),e--};s(),this.otpTimerInterval=setInterval(s,1e3)}stopOtpTimer(){this.otpTimerInterval&&(clearInterval(this.otpTimerInterval),this.otpTimerInterval=null)}startResendCooldown(){this.stopResendTimer();let e=30;const t=this.resendOtpBtn,s=document.getElementById("resendTimer"),n=()=>{s&&(s.textContent=e>0?`(${e}s)`:""),t&&(t.disabled=e>0),e--};n(),this.resendTimerInterval=setInterval(n,1e3)}stopResendTimer(){this.resendTimerInterval&&(clearInterval(this.resendTimerInterval),this.resendTimerInterval=null)}showErrorMessage(e,t,s){const n=document.getElementById(e),o=document.getElementById(t);n&&o&&(o.textContent=s,n.classList.remove("hidden"))}clearErrorMessages(){var e,t;(e=document.getElementById("otpErrorMessage"))==null||e.classList.add("hidden"),(t=document.getElementById("verifyErrorMessage"))==null||t.classList.add("hidden")}showSuccessMessage(e,t,s){const n=document.getElementById(e),o=document.getElementById(t);n&&o&&(o.textContent=s,n.classList.remove("hidden"))}clearSuccessMessages(){var e;(e=document.getElementById("verifySuccessMessage"))==null||e.classList.add("hidden")}setLoadingState(e,t){const s=document.getElementById(e);s&&(t?s.classList.remove("hidden"):s.classList.add("hidden"))}getCsrfToken(){var t;return((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""}updateTableWithDecryptedData(e,t){e.persons_involved&&e.persons_involved.length>0&&(document.querySelectorAll(`[data-expand-target="${t}-persons"]`).forEach(o=>{const i=e.persons_involved[0];e.persons_involved.length;const a=o.closest("tr");a&&a.setAttribute("data-persons-cached",JSON.stringify(e.persons_involved)),this.renderFirstItem(o,i,"persons",t)}),document.querySelectorAll(`tr:has([data-expand-target="${t}-persons"])`).forEach(o=>{if(e.persons_involved.length>1){let i=o.querySelector('.show-more-button[data-target="persons"]');if(i)i.setAttribute("data-total",e.persons_involved.length.toString()),i.setAttribute("data-expanded","false"),i.textContent=`Show more (${e.persons_involved.length-1} more)`,console.log(`[Decryption] Updated existing Show More button for persons in incident ${t}`);else{const a=o.querySelector(`[data-expand-target="${t}-persons"]`);if(a&&a.parentElement){const r=document.createElement("button");r.type="button",r.className="show-more-button text-xs text-blue-600 hover:text-blue-800 font-semibold cursor-pointer",r.setAttribute("data-incident-id",t.toString()),r.setAttribute("data-target","persons"),r.setAttribute("data-expanded","false"),r.setAttribute("data-total",e.persons_involved.length.toString()),r.textContent=`Show more (${e.persons_involved.length-1} more)`,a.parentElement.appendChild(r),console.log(`[Decryption] Created Show More button for persons in incident ${t}`)}}}})),e.evidence_items&&e.evidence_items.length>0&&(document.querySelectorAll(`[data-expand-target="${t}-evidence"]`).forEach(o=>{const i=e.evidence_items[0];e.evidence_items.length;const a=o.closest("tr");a&&a.setAttribute("data-evidence-cached",JSON.stringify(e.evidence_items)),this.renderFirstItem(o,i,"evidence",t)}),document.querySelectorAll(`tr:has([data-expand-target="${t}-evidence"])`).forEach(o=>{if(e.evidence_items.length>1){let i=o.querySelector('.show-more-button[data-target="evidence"]');if(i)i.setAttribute("data-total",e.evidence_items.length.toString()),i.setAttribute("data-expanded","false"),i.textContent=`Show more (${e.evidence_items.length-1} more)`,console.log(`[Decryption] Updated existing Show More button for evidence in incident ${t}`);else{const a=o.querySelector(`[data-expand-target="${t}-evidence"]`);if(a&&a.parentElement){const r=document.createElement("button");r.type="button",r.className="show-more-button text-xs text-blue-600 hover:text-blue-800 font-semibold cursor-pointer",r.setAttribute("data-incident-id",t.toString()),r.setAttribute("data-target","evidence"),r.setAttribute("data-expanded","false"),r.setAttribute("data-total",e.evidence_items.length.toString()),r.textContent=`Show more (${e.evidence_items.length-1} more)`,a.parentElement.appendChild(r),console.log(`[Decryption] Created Show More button for evidence in incident ${t}`)}}}})),console.log("Table updated with decrypted data for incident",t)}showNotification(e,t="info"){var o;const s=document.createElement("div"),n={success:"fas fa-check-circle text-green-600",error:"fas fa-exclamation-circle text-red-600",warning:"fas fa-exclamation-triangle text-yellow-600"};s.className="fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 z-[9999] flex items-center gap-3 animate-slide-in",s.innerHTML=`
            <i class="${n[t]}"></i>
            <span class="text-gray-700">${e}</span>
            <button class="ml-2 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        `,document.body.appendChild(s),(o=s.querySelector("button"))==null||o.addEventListener("click",()=>{s.remove()}),setTimeout(()=>{s.remove()},5e3)}}document.addEventListener("DOMContentLoaded",()=>{new u});
