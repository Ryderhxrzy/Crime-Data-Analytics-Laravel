const r=class r{static showIncidentNotification(i,t,o){console.log(`ðŸ”” NotificationManager.showIncidentNotification called (ID: ${t.id}, Event: ${o})`),"Notification"in window&&Notification.permission==="default"?Notification.requestPermission().then(e=>{e==="granted"&&this.createDesktopNotification(i,t,o)}):"Notification"in window&&Notification.permission==="granted"&&this.createDesktopNotification(i,t,o)}static createDesktopNotification(i,t,o){try{const e=this.getNotificationIcon(o),n=this.getDynamicLink(t.id),s=this.buildNotificationBody(t,o),c=new Notification(i,{body:s,icon:"/images/alertara.png",badge:"/images/alertara.png",tag:`crime-incident-${t.id}-${o}`,requireInteraction:!0,silent:!1});setTimeout(()=>{c.close(),this.activeNotifications.delete(`crime-incident-${t.id}-${o}`)},8e3),c.onclick=()=>{t.id?window.open(n,"_blank"):window.focus(),c.close(),this.activeNotifications.delete(`crime-incident-${t.id}-${o}`)},this.activeNotifications.set(`crime-incident-${t.id}-${o}`,c)}catch(e){console.error("Error creating desktop notification:",e)}}static buildNotificationBody(i,t){const o=[];if(o.push(`ðŸ“Œ ${i.incident_title}`),(i.category_name||i.location)&&o.push(`ðŸ“ ${i.category_name||"Unknown"} â€¢ ${i.location||"Unknown Location"}`),i.status||i.clearance_status){const n=i.status==="under_investigation"?"Under Investigation":i.status||"Unknown",s=i.clearance_status==="uncleared"?"Uncleared":i.clearance_status||"Unknown";o.push(`ðŸ·ï¸ Status: ${n} â€¢ Clearance: ${s}`)}if(i.incident_date){const n=new Date(i.incident_date).toLocaleDateString();o.push(`ðŸ“… ${n}`)}const e=t==="created"?"ðŸ†• New Report":t==="updated"?"ðŸ”„ Updated":t==="deleted"?"ðŸ—‘ï¸ Removed":"â„¹ï¸ Notice";return o.push(e),o.join(`
`)}static getDynamicLink(i){const o=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes(".local")?`${window.location.protocol}//${window.location.host}`:"https://crime-analytics.alertaraqc.com";return i?`${o}/crimes#${i}`:`${o}/crimes`}static getNotificationIcon(i){switch(i){case"created":return"âœ…";case"updated":return"ðŸ”„";case"deleted":return"ðŸ—‘ï¸";default:return"â„¹ï¸"}}static showGenericNotification(i,t,o="info"){console.log(`ðŸ”” NotificationManager.showGenericNotification called (Title: ${i}, Type: ${o})`),"Notification"in window&&Notification.permission==="default"?Notification.requestPermission().then(e=>{e==="granted"&&this.createGenericDesktopNotification(i,t,o)}):"Notification"in window&&Notification.permission==="granted"&&this.createGenericDesktopNotification(i,t,o)}static createGenericDesktopNotification(i,t,o){try{const e=new Notification(i,{body:t,icon:"/images/alertara.png",badge:"/images/alertara.png",tag:`generic-notification-${Date.now()}`,requireInteraction:!1,silent:!1});setTimeout(()=>{e.close()},5e3),e.onclick=()=>{e.close(),window.focus()}}catch(e){console.error("Error creating generic desktop notification:",e)}}};r.activeNotifications=new Map;let a=r;typeof window<"u"&&(window.NotificationManager=a);
